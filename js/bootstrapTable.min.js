let table,endBtable,data,dataCount,pagesTotal=0,pageCurrent=0,rowsToPage=50,itsSearchProcess=!1,searchResultData=[],optionsDefault={itemsToPage:50,hiddenColumns:["phone"],renameColumn:[{value:"id",replace:"ИД"},{value:"verify",replace:"Проверен"}],replace:[{value:"true",replace:'<span class="badge text-bg-success">да</span>'},{value:"false",replace:'<span class="badge text-bg-warning">нет</span>'}]};function initBtable(idTable,datat,options=optionsDefault){try{table=document.getElementById(idTable),data=datat,optionsDefault=options,calculatePages(options);let pnode=table.parentNode,container=document.createElement("div"),contTable=document.createElement("div");contTable.style.overflowX="auto",contTable.classList.add("mt-3"),contTable.append(table),endBtable=document.createElement("span"),endBtable.id="endBtable",contTable.append(table),contTable.append(endBtable),container.append(headerTable(options)),container.append(contTable),container.append(footerTable(options)),pnode.append(container),createHead(options),addFirstRows()}catch(error){alert(`При инициализации произошла ошибка: ${error}`)}}function addFirstRows(){if(clearTable(),dataCount>rowsToPage)for(let i=0;i<rowsToPage;i++)insertRow(data[i]);else for(let i=0;i<data.length;i++)insertRow(data[i])}function calculatePages(options){null!=options.itemsToPage&&(rowsToPage=parseInt(options.itemsToPage)),dataCount=data.length,pagesTotal=dataCount/rowsToPage,dataCount%rowsToPage>0&&pagesTotal++,console.log("Total pages: "+pagesTotal),console.log("Items count: "+dataCount)}function replaceData(value){let newValue=value;if(null!=optionsDefault.replace)for(let i=0;i<optionsDefault.replace.length;i++)optionsDefault.replace[i].value.indexOf(value)>-1&&(newValue=optionsDefault.replace[i].replace);return newValue}function insertRow(dataItem){let row=table.insertRow();for(let key in dataItem)null!=optionsDefault.hiddenColumns&&optionsDefault.hiddenColumns.indexOf(key.toString())>-1||(row.innerHTML+=`<td>${replaceData(dataItem[key])}</td>`)}function createHead(options){thead=table.createTHead();let row=thead.insertRow();for(let key in data[0])if(!(null!=optionsDefault.hiddenColumns&&optionsDefault.hiddenColumns.indexOf(key.toString())>-1))if(null!=optionsDefault.renameColumn){let matched=!1;for(let i=0;i<optionsDefault.renameColumn.length;i++)if(optionsDefault.renameColumn[i].value.indexOf(key)>-1){let newValue=optionsDefault.renameColumn[i].replace;row.innerHTML+=addHeaderCell(key,newValue),matched=!0;break}matched||(row.innerHTML+=addHeaderCell(key,key))}else row.innerHTML+=addHeaderCell(key,key)}function addHeaderCell(key,title){let cell;return`<th><span class="d-flex justify-content-between align-items-center">\n    <span class="me-2">${title}</span>\n    <button type="button" class="btn btn-outline-primary border-0" onclick="sortData('${key}')">\n    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-down-up" viewBox="0 0 16 16">\n    <path fill-rule="evenodd" d="M11.5 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L11 2.707V14.5a.5.5 0 0 0 .5.5zm-7-14a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L4 13.293V1.5a.5.5 0 0 1 .5-.5z"/>\n    </svg>\n    </button>\n    </span></th>`}function headerTable(options){let div=document.createElement("div"),header='<div class="row">\n    <div class="col-6">\n    <input class="form-control" type="search" placeholder="Найти" oninput="searchBtable(this)">\n    </div>\n    </div>';return div.innerHTML=header,div}function footerTable(options){let div=document.createElement("div"),noDataMsg='<div class="text-center p-2 text-muted" id="btabNoData" hidden>Нет данных для отображения</div>';return div.innerHTML+=noDataMsg,div}function tableScroll(){if(null!==endBtable){const windowHeight=window.innerHeight,boundingRect=endBtable.getBoundingClientRect(),yPosition=boundingRect.top-windowHeight;if(yPosition<500&&pageCurrent<pagesTotal){pageCurrent++;for(let i=pageCurrent*rowsToPage;i<rowsToPage*(pageCurrent+1);i++)insertRow(data[i])}}}function searchBtable(input){console.log(input.value);let btabNoData=document.getElementById("btabNoData");btabNoData.hidden=!0;let sText=input.value;pageCurrent=0;let findItems=0;if(input.value.length>0){itsSearchProcess=!0,clearTable(),searchResultData=[];for(let i=0;i<data.length;i++)for(let key in data[i])if(data[i][key].toString().indexOf(sText)>-1){insertRow(data[i]),findItems++,searchResultData.push(data[i]);break}console.log("Find items: "+findItems),0==findItems&&(btabNoData.hidden=!1)}else itsSearchProcess=!1,findItems=0,searchResultData=[],addFirstRows()}function sortData(keyName){data.sort((a,b)=>{const nameA=a[keyName],nameB=b[keyName];return nameA<nameB?-1:nameA>nameB?1:0}),data=data.reverse(),addFirstRows()}function clearTable(){let count;for(let i=table.rows.length-1;i>0;i--)table.deleteRow(i)}window.addEventListener("scroll",tableScroll);