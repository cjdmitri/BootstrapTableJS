/*!
 * Bootstrap Table JS
 * Version: 0.1.0
 * Release: 02.2023
 */ class BsTable{options={itemsToPage:50,tableHeight:"500px",fixedHeaderTable:!0};container;table;tbody;endBtable;noDataMsg;contTable;footer;#a;data;pagesTotal=0;pageCurrent=0;rowsToPage=50;searchResultData=[];itsSearchProcess=!1;needScroll=!1;constructor(t,e,s=null){this.table=document.getElementById(t),this.data=e,null!=s&&(this.options=s),this.#b();let i=this.table.parentNode;this.container=document.createElement("div"),this.container.classList.add("position-relative"),this.contTable=document.createElement("div"),this.contTable.style.overflowX="auto",this.contTable.classList.add("mt-3","position-relative"),void 0!=this.options.tableHeight&&(this.contTable.style.height=this.options.tableHeight.toString()),this.contTable.append(this.table),this.endBtable=document.createElement("div"),this.endBtable.id="endBtable",this.contTable.append(this.table),this.contTable.append(this.endBtable),this.contTable.append(this.#c()),this.container.append(this.#d()),this.container.append(this.contTable),this.container.append(this.#e()),i.append(this.container),this.#f(),this.#g(),this.#h(),this.#i(),void 0!=this.options.actions&&(this.#a=new ActionsRow(this.contTable,this.options)),console.log("BsTable created!")}#c(){return this.noDataMsg=document.createElement("div"),this.noDataMsg.classList.add("text-center","p-2","text-muted"),this.noDataMsg.hidden=!0,this.noDataMsg.innerHTML="Нет данных для отображения",this.noDataMsg}#j;get activeItemData(){return this.#j}set activeItemData(t){this.#j=t}insertRow(t){let e=this.tbody.insertRow();for(let s in t){if(!(void 0!=this.options.hiddenColumns&&this.options.hiddenColumns.indexOf(s.toString())>-1))e.insertCell().innerHTML=`${this.#k(t[s],t,s)}`}e.addEventListener("click",s=>{this.#l(t,e)},!1),e.addEventListener("mouseenter",s=>{this.#m(t,e)},!1),e.addEventListener("mouseleave",s=>{this.#n(t,e)},!1)}removeActiveItem(){let t=this.data.indexOf(this.activeItemData);this.data.splice(t,1),this.#o.remove(),this.activeItemData=null,this.#o=null,this.#a.hide(),console.log("Item deleted"),console.log("Items count: "+this.data.length)}search(t){if(this.#a.hide(),console.log(searchBTableInput.value),this.noDataMsg.hidden=!0,this.pageCurrent=0,t.length>0){this.itsSearchProcess=!0,this.clearTable(),this.searchResultData=[];for(let e=0;e<this.data.length;e++)for(let s in this.data[e])if(!(void 0!=this.options.hiddenColumns&&this.options.hiddenColumns.indexOf(s.toString())>-1)&&this.data[e][s].toString().indexOf(t)>-1){this.insertRow(this.data[e]),this.searchResultData.push(this.data[e]);break}console.log("Find items: "+this.searchResultData.length),0==this.searchResultData.length&&(this.noDataMsg.hidden=!1)}else this.itsSearchProcess=!1,this.searchResultData=[],this.#h()}#p=!1;sortData(t){let e=[];if(this.#a.hide(),this.contTable.scrollTop=0,(e=this.searchResultData.length>0&&this.itsSearchProcess?this.searchResultData:this.data).sort((e,s)=>{let i=e[t],a=s[t];return i<a?-1:i>a?1:0}),this.#p&&(e=e.reverse()),this.#p=!this.#p,this.searchResultData.length>0&&this.itsSearchProcess){this.clearTable(),this.searchResultData=e;for(let s=0;s<this.searchResultData.length;s++)this.insertRow(this.searchResultData[s])}else this.#h()}clearTable(){let t=this.table.rows.length;for(let e=t-1;e>0;e--)this.table.deleteRow(e)}#i(){setInterval(()=>{!this.itsSearchProcess&&this.data.length>this.rowsToPage&&this.pageCurrent<this.pagesTotal&&this.#q()&&this.#r()},500)}#o;#h(){if(this.clearTable(),0===this.data.length?this.noDataMsg.hidden=!1:this.noDataMsg.hidden=!0,this.data.length>this.rowsToPage)for(let t=0;t<this.rowsToPage;t++)this.insertRow(this.data[t]);else for(let e=0;e<this.data.length;e++)this.insertRow(data[e])}#l(s,i){this.activeItemData=s,this.#o=i,void 0!=this.options.actions&&this.#a.show(s,i)}#m(a,o){}#n(n,l){}#b(){void 0!=this.options.itemsToPage&&(this.rowsToPage=parseInt(this.options.itemsToPage)),this.data.length=this.data.length,this.pagesTotal=Math.round(this.data.length/this.rowsToPage);this.data.length%this.rowsToPage>0&&this.pagesTotal++,console.log("Total pages: "+this.pagesTotal),console.log("Items count: "+this.data.length)}#k(h,r,d){let c=h;if(void 0!=this.options.replace)for(let p=0;p<this.options.replace.length;p++)if("{value}"===this.options.replace[p].value){if(d===this.options.replace[p].key){let $=r[d];c=this.options.replace[p].replace.replaceAll("{value}",$)}}else this.options.replace[p].value.indexOf(h)>-1&&this.options.replace[p].key.indexOf(d)>-1&&(c=this.options.replace[p].replace);return c}#f(){this.thead=this.table.createTHead(),!0===this.options.fixedHeaderTable?this.thead.classList.add("sticky-top","bg-white","shadow"):this.thead.classList.add("bg-white","shadow");let g=this.thead.insertRow();for(let u in this.data[0])if(!(void 0!=this.options.hiddenColumns&&this.options.hiddenColumns.indexOf(u.toString())>-1)){if(void 0!=this.options.renameColumn){let b=!1;for(let w=0;w<this.options.renameColumn.length;w++)if(this.options.renameColumn[w].key.indexOf(u)>-1){let m=this.options.renameColumn[w].replace;g.appendChild(this.#s(u,m)),b=!0;break}b||g.appendChild(this.#s(u,u))}else g.appendChild(this.#s(u,u))}}#g(){this.tbody=this.table.querySelector("tbody"),(null===this.tbody||void 0===this.tbody)&&(this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody));let v=new MutationObserver(this.#t);v.observe(this.tbody,{attributes:!0,childList:!0,subtree:!1})}#t=(t,e)=>{for(let s of t)if("childList"===s.type){let i=this.tbody.querySelectorAll("tr").length;this.#u.innerHTML=`Записей <strong>${i}</strong> из <strong>${this.data.length}</strong>`}else s.type};#s(f,R){let T=document.createElement("th"),_=document.createElement("span");_.classList.add("d-flex","justify-content-between","align-items-center");let L=document.createElement("span");L.classList.add("me-2"),L.innerHTML=`${R}`;let y=document.createElement("button");return y.classList.add("btn","btn-outline-primary","border-0"),y.addEventListener("click",t=>{this.sortData(`${f}`),console.log(`Sort by: ${f}`)},!1),y.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-down-up" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M11.5 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L11 2.707V14.5a.5.5 0 0 0 .5.5zm-7-14a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L4 13.293V1.5a.5.5 0 0 1 .5-.5z"/>
        </svg>`,_.appendChild(L),_.appendChild(y),T.appendChild(_),T}#d(){let D=document.createElement("div");D.classList.add("row");let C=document.createElement("div");C.classList.add("col-6");let E=document.createElement("input");E.classList.add("form-control"),E.setAttribute("type","search"),E.setAttribute("placeholder","Найти"),E.setAttribute("id","searchBTableInput"),E.addEventListener("input",t=>{this.search(E.value)},!1),C.appendChild(E),D.appendChild(C);let x=document.createElement("div");return x.classList.add("col-6","d-flex","justify-content-end"),D.appendChild(x),D}#v(){return document.createElement("div")}#q(){let M=window.innerHeight,P=this.endBtable.getBoundingClientRect(),S=P.top-M;return S<500}#r(){if(!this.itsSearchProcess&&this.#q()&&this.pageCurrent<this.pagesTotal){this.pageCurrent++;for(let B=this.pageCurrent*this.rowsToPage;B<this.rowsToPage*(this.pageCurrent+1);B++)this.insertRow(this.data[B])}}#w;#u;#e(){this.#w=document.createElement("div"),this.#w.classList.add("mt-3","row");let H=document.createElement("div");H.classList.add("col-6");let I=document.createElement("div");return I.classList.add("col-6"),this.#u=document.createElement("label"),H.append(this.#u),this.#w.append(H),this.#w.append(I),this.#w}}class ActionsRow{#a;#x;#y;constructor(t,e){this.#y=e,this.#a=document.createElement("div"),this.#a.classList.add("position-absolute","bg-white","shadow","p-2","d-flex","justify-content-between","align-items-center","d-none"),this.#a.style.zIndex="1000",this.#a.style.left="0px",this.#a.style.top="0px",this.#a.style.border="1px solid #c7c7ff",this.#a.style.borderRadius="5px",this.#a.style.transition="all 0.2s ease 0s",this.#a.hidden=!0,this.#x=document.createElement("div"),this.#x.classList.add("btn-group","me-5"),this.#a.append(this.#x);let s=document.createElement("button");s.type="button",s.classList.add("btn-close"),this.#a.append(s),s.addEventListener("click",t=>{this.hide()},!1),t.append(this.#a)}show(t,e){if(void 0!=this.#y.actions&&(this.#a.hidden=!1,this.#a.style.top=e.offsetTop+"px",this.#a.classList.remove("d-none"),this.#x.innerHTML=null,void 0!=this.#y.actions))for(let s=0;s<this.#y.actions.length;s++){let i=this.#y.actions[s];for(let a in t){let o=`{${a}}`;i=i.replaceAll(o,t[a])}this.#x.innerHTML+=i}}hide(){void 0!=this.#y.actions&&null!=this.#a&&(this.#a.hidden=!0,this.#a.classList.add("d-none"))}}